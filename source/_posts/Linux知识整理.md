---
title: Linux知识整理
date: 2018-07-24 16:40:55
categories: Linux
tags:
    - Linux
---
>前言：整理巩固一下Linux的知识

# Linux
---

## 简介
* 特点：多用户多任务、良好的兼容性、可移植性强、稳定性高、界面美观

* 版本：X.Y.Z  主版本号、次版本号(偶数是正式版本，奇数是测试版本不稳定)、修改次数

* 系统结构

     |             Linux系统结构              |
     | :------------------------------------:|
     |                应用程序                |
     | 应用程序                     X  Window |
     |                Shell层                 |
     |                  内核                  |


    1. Shell层：用户与内核之间的桥梁。
    2. 内核：操作系统的核心，管理着整个计算机的软硬件资源。
    3. 分区：至少要有两个分区  swap分区和 根分区。
    4. 文件管理：ext4文件系统
    5. 设备管理：  
        * 字符设备：以字符为单位进行输入输出，CPU能直接进行读写。      打印机，扫描仪，声卡、显卡、鼠标、键盘等
        * 块设备：以数据块为单位进行输入输出，CPU不能直接进行读写，要经过缓冲区。    硬盘、光盘、U盘
        * 网络设备：以数据包进行数据交换。网卡
        * 注：无论是哪类设备，Linux都统一当做文件来处理

<!-- more -->

---

## 命令

    命令提示符
        [root@centos  ~]#
        [ding@centos  ~]$
      用户名、主机名、目录名、提示符
    
    命令格式
        命令名 [选项] [参数]


    注销  exit    Ctrl+D
    重启  reboot   shutdown -r now    注：-r的选项是reboot
    关机  halt     shutdown -h now    注：-h的选项是halt 
    
    查看时间：date
    修改时间：date 184512302017     点数 月份 年
    显示日历：cal  可加参数 [年份],查看全年日历
    
    pwd 显示当前目绝对路径
    
    cd 切换目录
    
    ls  -l  显示详细信息(文件类型、权限、所有者、组群、文件大小、修改时间、文件名)
        -a  显示所有文件和目录
    
    cat   显示文本文件内容
        -n 在内容前显示行号
    
    more/less 文件   分屏显示文件(文件过长时，一屏幕一屏幕的显示)
                按空格 显示下一屏， 按回车 显示下一行， 按q 退出more命令
    
    tail [选项] 文件    显示文本结尾部分
         -n 10 文件名  显示文件的倒数10行
    head命令与tail相同
    
    man 命令名    显示命令的手册页帮助信息，按q退出man   命令不懂找男人
    命令名 --help  显示命令的帮助信息(非所有命令都有此选项)   
    
    clear   清屏
    
    wc [选项] 文件     按顺序显示： 行数 单词数 字符数 文件名
        -c    显示文件的字符数    char
        -l    显示文件的行数      low
        -w    显示文件的单词数    word
    
    > 输出重定向   < 输入重定向   >> 附加输出重定向     错误重定向：结果显示在屏幕上，错误信息重定向到指定文件用  2>
                                                                结果和错误信息都重定向到指定文件用  &>
    
    创建f1文件： cat >f1    进入输入界面，到文本的下一行按 Ctrl+D 结束输入
    
    附加输出重定向：   cat >>f1  在f1后追加内容
    
    管道  |  前一个命令的执行结果是后一个命令的执行条件   ls  | wc -l    统计当前目录下的文件和目录总数
    
    history 5  查看最近执行的 5条命令 命令上限1000
    !! 命令 再次执行上一条命令，!5 执行history中 5 对应的命令
    
    别名：alias vi='vim'

---
## vim编辑器
    命令模式：刚进入vi时的模式
    文本模式：i
    最后行模式：按 [shift和冒号] 进入
    
    输入文本   [命令模式下]
        i/I  a/A  o/O
    
    查找字符串  [命令模式下]
        /字符串    从头往下找，找到则停在字符串首字母上
        ？字符串   从当前位置往下找，找到停在字符串首字母上
           n      继续查找满足条件的字符串
           N      改变查找方向，继续查找满足条件的字符串
    
    撤销与重复   [命令模式下]
        u  撤销上一步操作
        .  重复上一步操作
    
    文本块操作
        set nu       显示行号
        set nonu     不显示行号
        n1,n2 co n3  将 [n1,n2]行，复制到n3行之下
        n1,n2 m n3   将 [n1,n2]行，移动到n3行之下
        n1,n2 d      删除 [n1,n2]行
        n1,n2 s/字符串1/字符串2/g      将[n1,n2]行中所有的 [字符串1] 用 [字符串2] 替换
    
    保存与退出
        [命令模式下] 连续按两次 z 保存并退出
        
        [最后行模式下]
            :w 文件  保存为指定的文件
            :q       退出，若文件有改动则提示
            :q!      不保存直接退出
            :wq      存盘并退出
            :x       存盘并退出









---
## 运行级别   

* 配置文件在  /etc/inittab  默认运行级别为 5
    | 数字|模式 |
    |:-:|:------|
    | 0| 关机 |
    | 1|  单用户模式  |
    | 2|  多用户模式，不提供NFS  |
    | 3| 完整的多用户模式，仅提供`字符界面`  |
    | 4|  保留的运行级别    |
    | 5|  完整的多用户模式，自动启动`图形化用户界面` |
    | 6|  重新启动  |

* GNOME环境下：`Ctrl+Alt+[F2-F6]` 回到字符界面
* 字符界面下：按`Alt+F1` 回到 GNOME桌面

---
## 用户和群组
    超级用户：UID 0        所属组群 GID 0
    系统用户  UID 1-499    所属组群 GID 1-499
    普通用户  UID 500-     所属组群 GID 500
    
    用户账号信息文件：/etc/passwd
            文件内容：root:x:0:0:root:/root:/bin/bash
                用户名 密码 UID GID 全名 主文件夹
    
    用户密码信息文件：/etc/shadow
    
    组群账号信息文件：/etc/group
            文件内容：root:x:0:
                     bin:x:1:bin,daemon     组群名 组群密码 组群管理员密码  以此组群为附加组群的用户列表
    
    组群密码信息文件：/etc/gshadow
            文件内容：root:::                     加密密码字段为 !!
                     bin:::bin,daemon     组群名 组群加密密码 组群管理员密码  以此组群为附加组群的用户列表

* `useradd`  创建用户账号 超级用户才能使用
    ```
        -c  全名
        -d  主目录
        -g  指定用户的主要组群
        -G  指定用户的附加组群
        -u  指定用户的UID
        -M  只创建用户，不创建主目录
    ```
* `passwd`     设置或修改密码 以及 密码属性
    ```
        -d  删除用户密码
        -l  锁定用户
        -u  解除锁定
        -S  显示指定用户账号的状态
    ```
* `usermod` [选项]  用户名    修改用户属性 超级用户才能使用
    ```
        -c 全名        指定用户的全称
        -d 主目录      指定用户的主目录
        -g                 指定用户的主要组群
        -G 组群ID或组群名   指定用户的附加组群
        -u 用户ID      指定用户的UID
        -l 用户名      指定用户的新名称
    ```
* `userdel`     删除用户账号 超级用户才能使用
    ```
        -r  删除用户的账号和主目录，无此选项则保留主目录
    ```
* `su [-][用户名]`    
    ```
        切换用户, `-` 选项表示切换到用户的主目录    
        无用户名参数则切换到root用户
    ```
* `id [用户名]` 查看用户的 UID、GID 和 用户所属组群

* `groupadd [选项] 组群名`    新建组群，只有超级用户才能使用
    ```
         -g 组群id     指定组群的GID  
    ```
* `groupmod` [选项] 组群名    新建组群，只有超级用户才能使用
    ```
         -g 组群id     指定组群的GID 
         -n 组群名     指定组群的新名字   
    ```
* `groupdel` 组群名   删除组群，只有root用户才能使用

---
## 批量创建多个用户
1. 创建 students 组群  
           ` # groupadd -g 600 students`

2. 创建用户信息文件  
        使用文本编辑器编辑 /etc/passwd   编辑好后保存为students.txt
        student1:x:601:600::/home/student1:/bin/bash
        student2:x:602:600::/home/student2:/bin/bash
    
3. 创建用户密码,保存为password.txt  
        ```shell

            student1:123456
            student2:123456
        ```

4. 批量创建用户账号  
        `# newusers < students.txt `      
        文件已经追加到 /etc/passwd ，系统已经在 /home 目录中为每位用户创建了主目录

5. 暂时取消 shadow 加密  
       ` # pwunconv`

6. 为用户设置密码  
        `# chpasswd < passwd.txt `  
    密码追加到了/etc/shadow  在passwd文件内能看到密码

7. 恢复 shadow 加密  
    `# pwconv`

8. 批量创建的用户，主目录中都缺少 `.bash_profile` 和 `.bashrc`

---
## 文件系统

* 挂载：将存储介质的内容映射到指定的目录，此目录为该设备的挂载点。一个挂载的点一次只能挂载一个设备

      `/etc/fstab`  保存着文件系统 开机自动挂载信息  
      `/etc/mtab `  保存着当前系统中 文件系统的挂载信息

* 文件分类：普通文件、目录文件、链接文件、设备文件

* 文件布局：

    |    目录    | 功能                                                 |
    | :--------: | :--------------------------------------------------- |
    |     /      | Linux目录结构的起点                                  |
    |    bin     | 存放可执行命令，如chmod、data                        |
    |    boot    | 存放系统启动时所需要的文件，包括内核和引导装载程序   |
    |    dev     | 存放所有的设备文件，如cdrom光盘文件                  |
    |    etc     | 存放系统配置文件，如passwd、fstab                    |
    |    home    | 包含所有普通用户的主目录                             |
    |    lib     | 包含系统二进制文件所需要的共享库                     |
    | lost+found | 存放文件系统发生故障后无法归位的文件                 |
    |   media    | 移动存储戒指的默认挂载点                             |
    |    mnt     | 用于临时挂载文件系统                                 |
    |    proc    | 存放进程的运行信息，由内核在内存中产生               |
    |    root    | 超级用户的主目录                                     |
    |    sbin    | 存放系统管理命令，一般只有超级用户才能使用           |
    |  selinux   | 存放SELinux的相关文件                                |
    |    tmp     | 存放公用的临时文件                                   |
    |    usr     | 存放应用程序及相关文件                               |
    |    vsr     | 存放系统中经常变化的文件，如系统日志文件，用户邮件等 |



* 文件扩展名
    1. 系统文件  
        |  后缀  |  文件  |
        | :---: | :---- |
        |.rpm|RPM软件包文件|
        |.conf|系统配置文件|
        |.lock |锁定文件|

    2. 归档和压缩文件
        |  后缀  |  文件  |
        | :---: | :---- |
        |.zip   |zip压缩文件|
        |.tar   |归档文件|
        |.gz    |gzip命令产生的压缩文件|
        |.bz2   |bzip2命令产生的压缩文件|

    3. 程序和脚本文件
        |  后缀  |  文件  |
        | :---: | :---- |
        |.c   |C语言源程序代码文件|
        |.cpp | C++语言源程序代码文件|
        |.o   |程序对象文件|
        |.so  | 库文件|
        |.sh  | Shell脚本文件|

    4. 多媒体文件

        |    后缀    | 文件           |
        | :--------: | :------------- |
        |    .gif    | gif图像文件    |
        |    .jpg    | GPEG图像文件   |
        |    .png    | png图像文件    |
        | .htm或html | HTML超文本文件 |
        |    .wav    | 音频波形文件   |

        

---
## 权限

* 读取权限：r 、写入权限：w 、执行权限：x

* 字母表示法
    `- rwx rwx rwx` 文件权限一共10个字符，中间无空格
    * 第一个字符：文件类型。    
    
        |  字符  | 文件类型 |
        | :---: | :---- |
        | - | 普通文件 |
        | d | 目录文件 |
        | l | 连接文件 |
        | b | 块设备文件 |
        | c | 字符设备文件 |

    * 后面每三个一组，分别表示 当前用户 u，用户所在的组 g，其他 o

* 数字表示法
    |  权限  | 数字 |
    | :---: | :----: |
    | r/读  | 4 |
    | w/写  | 2 |
    | x/执行 | 1 |

* 修改权限

    1. chmod 数字模式 文件     
        `chmod 755 file`
    2. chmod 功能模式 文件     
        `chmod g-w file`

    * 功能模式
        * 对象：    
            `u` 文件所有者 user  
            `g` 同组用户   group  
            `o` 其他用户   other  

        * 操作符:  
            `+` 增加权限  
            `-` 删除权限  
            `=` 赋予权限  
        * 权限：  
            r/读：4    
            w/写：2  
            x/执行：1  
    
    * `chgrp  组群 文件` ：改变文件所属组群
    
    * `chown 文件所有者[:组群] 文件` ：改变文件所有者，并可一并修改文件的所属组群   
        `# chown ding:ding f1` ：把文件f1的 所有者 和 组群 一并改为 ding

---
## 基础文件命令

* 创建目录  mkdir
    ```shell
        mkdir [选项] 目录  
                -m 创建目录的同时设置目录的访问权限
                -p 一次创建多级目录      
        例：
            mkdir -p ding/f
            rmdir -p ding/f     
    ```

* 移动或重命名目录   mv
    ```shell
        mv [选项] 源文件或目录 目标文件或目录
            -b   若存在同名文件，则在覆盖之前备份原来的文件
            -f   强制覆盖同名文件
        例：
            mv pict picture  改名
            mv file ding/    将file文件移动到ding目录
    ```

* 复制文件或目录   cp
    ```shell
        cp [选项] 源文件或目录 目标文件或目录
            -b   若存在同名文件，则在覆盖之前备份原来的文件
            -f   强制覆盖同名文件
            -r/-R  按递归方式，保留原目录结构复制文件
    ```

* 删除文件或目录   rm
    ```shell
        rm [选项] 文件或目录
            -f      强制删除，不需要确认
            -r/-R   按递归方式删除目录
            i       再次确认是否删除
        例：
            rm -rf /*
    ```

* 立链接文件，默认硬链接  ln 
    ```shell
        ln [选项] 目标文件 链接文件
            -b  若存在同名，则覆盖前先备份
            -s  建立符号链接文件
        例：
            ln -s /etc/passwd passwd.lnk
    ```

* 查找：find 查找文件/grep 查找内容

    1. find   查找文件或目录

        ```shell
            find [路径] 表达式    从指定路径开始向下搜索满足表达式的文件和目录。不指定路径，则查找当前目录
                -name 文件           按文件名查找，可使用通配符       locate 与 find -name相同
                -group 组群名        查找文件所属组群为指定组群的文件
                -user 用户名         查找文件所有者为指定用户的文件
                -type 文件类型       按文件类型查找，d为目录文件，l为链接文件
                -size [+|-]文件大小  查找指定大小的文件，+ 表示超过，-表示不足
            例：     
                find -name f*   从当前目录查找 f 开头的文件
                find /etc -name fs*  
                find -type l
                find -size +100k
        ```

    2. grep   查找指定文件中的字符串

        ```shell
            grep [选项] 字符串 文件列表      从指定文件中查找符合条件的字符串，默认显示字符串所在的行
                -n     显示行号
                -v     显示不包含指定字符串的行
                -i     查找是不区分大小写
            例：
                grep -n root /etc/passwd   查找passwd中包含 root 的行，并显示行号
        ```


        显示文件大小，默认以KB为单位  du
            du [选项] [目录或文件]
                -a  显示指定目录及所有子目录和文件的大小，默认只显示目录的大小
                -h  以易读的方式显示目录或文件的大小，加上单位
                -s  只显示指定目录的大小，而不显示子目录的大小
            例：
                du -sh /home/ding
        ```

---
## 归档和压缩  

* tar [] 文件名
    |命令|选项|功能|
    |:--:|:-:|:----|
    | tar|选项| 归档/压缩文件 文件或目录列表|
    |    |-c | 创建归档文件|
    |    |-t | 显示归档文件的内容  |
    |    |-x | 还原归档文件中的目录  |
    |    |-v | 显示归档命令的执行过程 |
    |    |-z | 采用gzip方式压缩/解压缩归档文件  |
    |    |-j | 采用bzip2方式压缩/解压缩归档文件|
    |    |-f | tar命令必须的选项|

    例：  
        `tar -cf etc.tar /etc/*.conf`  
        `tar -czf etc.tar.gz /etc/*.conf`

* gzip [] 文件名
    |命令|选项|功能|
    |:--:|:-:|:----|
    | gzip|    |压缩或解压文件|
    | gzip|[选项]|文件或目录 |
    |     | -d | 解压缩文件，相当于gunzip命令|
    |     | -r | 参数为目录是，按目录结构递归压缩目录中的所有文件|
    |     | -v | 显示文件的压缩比例|


    例：
        `gzip 文件名` 压缩或解压缩格式为 .gz的文件。压缩完后会删除源文件
        `gzip *`    压缩当前目录所有文件，没有归档功能，压缩多个文件时每个都是.gz压缩文件

* bzip2 [] 文件名
    |命令|选项|功能|
    |:--:|:-:|:----|
    | bzip2|    |压缩或解压文件|
    |bzip2 |[选项]| 文件或目录|
    |      |  -d | 解压缩文件，相当于bunzip2命令|
    |      |  -v | 显示文件的压缩比例|

    例：
        `bzip2 文件名` 压缩或解压缩格式为 .bz2的文件。压缩完后会删除源文件
        `bzip2 *.bz2` 解压当前文件夹所有bz2文件`

* `zip [选项] 压缩文件 文件列表`

        -m  压缩完后删除源文件
        -r  地柜压缩
        
        例：
            zip file.zip *


* `unzip [选项] 压缩文件`     解压缩.zip文件

        -l       查看压缩文件所包含的文件
        -t       测试压缩文件是否已损坏
        -d 目录名   指定解压缩的目标目录 
        -n       不覆盖同名文件
        -o       强制覆盖同名文件
        例：
            unzip -d dir file.zip   解压到dir目录

---
## RPM软件包

    安装RPM软件包
        rpm -i[选项] 软件包文件
            -v      显示安装过程
            -h      以 # 表示安装进度
            -replacepkgs    重复安装软件包  
    
    查询RPM软件包
        rpm -q[选项] 软件包
            -l      查询已安装软件包所包含的所有文件
            -i      查询已安装软件包的详细信息
            -a      查询已安装的所有软件包
            -f 文件名  查询指定文件所属的软件包
    
    删除RPM软件包
        rpm -e 软件包



---
## YUM命令管理软件包

    安装软件包/软件包集
        yum install 软件包名
        yum groupinstall 软件包集名
    
    安装vsftpd软件包
        yum install vsftpd
    
    查询软件包/软件包集信息
        yum info 软件包名
        yum groupinfo 软件包集名
    
    查询vsftpd软件包的信息
        yum info vsftpd
    
    删除软件包/软件包集
        yum remove 软件包名     删除RPM软件包
        yum groupremove 软件包集名     删除RPM软件包集
        yum remove vsftpd     删除vsftpd软件包

---
## 进程管理

* 进程：是具有独立功能的程序的一次运行过程

* 一个程序可启动多个进程，一个进程可调用多个程序

* 进程的优先级的取值范围：-20~19

* 进程的状态：

    ```
        就绪状态：进程已获得除CPU外的运行所需的全部资源
        运行状态：进程占用CPU正在运行
        等待状态：进程正在等待某一事件或某一资源

        进程同步：相关进程为协作文成同一任务而引起的直接制约关系
        进程互斥：进程间因竞争系统资源而引起的间接制约关系
        进程死锁：对资源保持请求、对资源的循环等待、对资源的非抢占式分配、资源的独占使用
    
        挂起状态：正在运行的进程，因为某个原因失去CPU而暂时停止运行、
        终止状态：进程已结束
        休眠状态：进程主动暂时停止运行
        僵死状态：进程已停止运行，但是相关控制信息仍保留
    ```
* 作业：

    1. 概念  
        正在执行的一个或多个相关进程可形成一个作业  
        一个作业可启动多个进程  
        作业分前台作业和后台作业  

    2. Shell的命令的末尾加上一个 & 符号，将启动一个后台作业

```shell
    jobs [选项]   显示当前所有的作业
        -p     仅显示作业号
        -l     显示进程号和作业号
    bg [作业号]   将前台作业切换到后台运行，若未指定作业号，则将当前作业切换到后台
    fg [作业号]   将前台作业切换到前台运行，若未指定作业号，则将当前作业切换到前台
  
    例：
        vi f1       编辑文件f1
        Ctrl z      挂起vi
        jobs -l     显示进程号和作业号
        bg 1        将作业切换到后台
        Ctrl z      挂起vi
        fg 1        将作业再切换到前台
  
    ps [选项]     显示进程的状态，无选项时显示当前用户在当前终端启动的进程
        -a      显示当前终端上所有的进程
        -A      显示系统所有进程，包括其他用户进程和系统进程
        -l      显示进程的详细信息、包括父进程号、进程优先级等
        u       显示包括进程的所有者在内的详细信息
        x       显示后台进程的信息
        -t 终端号 显示指定终端上的进程信息
  
    pstree [选项]   以树形图显示进程之间的相互关系
            -a      显示启动进程的命令行
            -n      按照进程号进行排序
```


* 终止正在运行的进程，超级用户可终止所有进程，普通用户只能终止自己的进程
    ```shell
        kill % 作业号
        kill [选项] 进程号    选项填数字
            HUP   1    终端断线
            INT   2    中断（同 Ctrl + C）
            QUIT  3    退出（同 Ctrl + \）
            TERM  5    终止
            KILL  9    强制终止
            CONT  8    继续（与STOP相反， fg/bg命令）
            STOP  9    暂停（同 Ctrl + Z）
        例：
            kill -9 2638   强行终止2638进程
    ```

---
## 进程调度

* at调度
    ```shell
    at [选项] [时间]
        -l  显示等待执行的调度作业
        -d  删除指定的调度作业
    进程的执行时间可表示为：1.绝对计时法：HH:MM(24时制)、HH:MM(12时制加AM/PM) 日期写在时间后面，格式为：月日年
    例：
        at 23:59 01012018
        at>wall Happy New Year!      输入at调度后会出现 at> 提示符， 输入完成后按 Ctrl D
    ```
* batch调度
    ```shell
        在系统空间时运行，适合时间上要求不高，但运行时占系统资源较多的工作 
        输入batch还是出现 at> 提示符， 输入完成后按 Ctrl D
    ```

* cron调度
    ```shell
        at和batch调度的命令智能执行一次，cron调度能重复执行
        cron调度与crond进程、crontab命令和crontab配置文件有关
    ```
* crontab配制文件
    ```shell
        保存在/var/spool/cron 目录中，文件名与用户名相同
        也即halen用户的crontab配置文件为/vwr/spool/crontab/helen
        crontab配置文件保留cron调度的内容，每行表示一个调度任务，每个调度任务包括六项字段
          字段：   分钟   时    日期    月份      星期          命令   (倒着：星期，月日时分)
        取值范围： 0-59  0-23  01-31   01-12  0-6(0是星期天)  
        
        "-"符号表示一段时间    ","符号表示指定时间，如5,15,25     "/"表示时间的间隔，如日期栏中输入 */3 表示每隔三天
    ```
    ```
    crontab [选项]   管理crontab配置文件
            -e  创建并编辑crontab配置文件
            -l  显示crontab配置文件的内容
            -r  删除crontab配置文件
    ```

 * crond 进程  
        ```  
        crond进程在系统启动时自动启动，并一直运行在后台，负责检测crontab配置文件，并按照其设置内容定期重复执行cron的调度工作

        ```



* 实施系统监视的Shell命令
    ```shell
        who [选项]   查看当前已登录的所有用户
            -H  显示出信息标题行
        
        top [-d 秒数]   动态显示CPU利用率、内存利用率和考必过状态等相关信息，默认每5s更新显示信息。-d 秒数 可以指定更新间隔
        
        free [选项]     显示内存和交换分区的使用情况
            -m    以MB为单位显示，默认以KB为单位
            -t    增加显示内存和交换分区的总数和信息

    ```



---
## 思考题  (cron调度)

    (1) 下午4:50删除/abc 目录下的全部子目录和全部文件
          50 16 * * * rm -rf /abc/*
    
    (2) 早8:00--下午6:00 每小时一次将/xyz 目录下 x1 文件的最后5行加入到/backup 目录下的 back01.txt
          0 8-18 * * *  tail -5 /xyz/x1 >> /backup/back01.txt
    
    (3) 每周一下午5:50将/data 目录下的所有目录和文件归档并压缩为文件 backup.tar.gz
          50 17 * * 1 tar -czvf backup.tar.gz /data         v是显示执行过程 
                                                            f是必带选项 
                                                            c是归档 
                                                            z是gzip压缩